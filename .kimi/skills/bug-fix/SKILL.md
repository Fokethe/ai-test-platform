---
name: bug-fix
description: Bug修复工作流 - 诊断→修复→验证→提交 完整流程（含防循环保护）
---

# Bug Fix Skill

一键执行 Bug 修复的完整工作流，包含诊断、修复、审查、防循环保护。

## 触发方式

```bash
/skill:bug-fix
```

或关键词：
- "修复bug"
- "debug"
- "报错了"
- "出错了"

## 执行流程

```
┌─────────────────────────────────────────────────────────────┐
│  Step 1: cost-control                                       │
│  └─ 记录修复前消耗                                           │
├─────────────────────────────────────────────────────────────┤
│  Step 2: debug-diagnosis                                    │
│  ├─ 分析错误信息                                             │
│  ├─ 定位根因                                                 │
│  └─ 输出修复方案                                             │
├─────────────────────────────────────────────────────────────┤
│  Step 3: danger-signals                                     │
│  ├─ 检查修复次数（防循环）                                    │
│  ├─ 如第3次仍未解决 → 提示回滚                               │
│  └─ 其他危险信号检查                                         │
├─────────────────────────────────────────────────────────────┤
│  Step 4: code-review                                        │
│  ├─ 审查修复代码                                             │
│  └─ 验证修复质量                                             │
├─────────────────────────────────────────────────────────────┤
│  Step 5: doc-system                                         │
│  ├─ 记录问题到 progress.txt                                  │
│  └─ 更新技术债务区                                           │
├─────────────────────────────────────────────────────────────┤
│  Step 6: git-commit                                         │
│  └─ 生成 fix 类型 commit message                            │
├─────────────────────────────────────────────────────────────┤
│  Step 7: cost-control (总结)                                │
│  └─ Debug 成本统计                                           │
└─────────────────────────────────────────────────────────────┘
```

## 防循环保护

```
第1次修复: ✓ 正常执行
第2次修复: ⚠️ 提示"如再次失败建议回滚"
第3次修复: 🚨 强制提示"已修复3次未解决，建议回滚到稳定版本"
```

## 使用示例

```
用户: 报错了，帮我修复
AI: [自动执行 /skill:bug-fix]
    📊 当前消耗: $0.045
    
    [debug-diagnosis] 分析中...
    🔍 根因: projectId 无效导致外键约束失败
    💡 方案: 从 URL 参数获取 projectId
    
    [danger-signals] 检查中...
    ✓ 第 1 次修复，继续
    
    [显示 diff]
    
用户: 确认修复
AI: [执行 code-review → git-commit → /cost]
    ✓ 修复完成
    📊 Debug 成本: $0.023
```

## 特殊指令

- "重新诊断" → 回到 Step 2
- "放弃修复" → 停止流程，提示回滚方案
